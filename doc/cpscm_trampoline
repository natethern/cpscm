21.10.2010
prev: driving-functions

Trying to understand "cpscm__trampoline" (Scheme version)

to check if I really understand translation, let me translate this scheme code manually:

(* (+ 1 2) (+ 1 (id 2)))

(cpscm__drive
  ((lambda (gk1)
    (cpscm__trampoline
      (cpscm+
        (lambda (gret+_2)
          (cpscm__trampoline
            (cpscmid
              (lambda (gretid_3)
                (cpscm__trampoline
                  (cpscm+
                    (lambda (gret+_4)
                      (cpscm__trampoline
                        (cpscm*
                          gret+_2
                          gret+_4)))
                    1
                    gretid_3)))
              2)))
        1
        2)))))

Checking with the real result:

(cpscm__drive
  ((lambda (gk1)
     (cpscm__trampoline
       (cpscm+
         (lambda (gret+_2)
           (cpscm__trampoline
             (cpscmid
               (lambda (gretid_3)
                 (cpscm__trampoline
                   (cpscm+
                     (lambda (gret+_4)
                       (cpscm__trampoline (cpscm* gk1 gret+_2 gret+_4)))
                     1
                     gretid_3)))
               2)))
         1
         2)))
   (lambda (cpscmx) cpscmx)))

1) I forget to pass an initial continuation to the drive-function
2) (cpscm* gret+_2 gret+_4) should be (cpscm* gk1 gret+_2 gret+_4)

I still do not see the need of the function "cpscm__trampoline".
As a check, I've written a test with a dummy functions:

tests/dummy-drive.scm

and it works.
